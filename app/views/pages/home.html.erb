<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Main Page</title>
<%= stylesheet_link_tag 'home' %>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="top-contents">
        <div class="welcome-box">
            <h2>Welcome Back</h2>
            <p class="top-username">
                <% if logged_in? %>
                    <%= current_user.name %>さん
                <% else %>
                    ユーザー名さん
                <% end %>
            </p>
            <p>今日も目標達成に向けて行動しましょう！</p>
        </div>
        <div class="user-box">
            <%= link_to(image_tag('usericon.png', alt: 'usericon', class: 'user-icon')) %>
            <p class="icon-username">
                <% if logged_in? %>
                    <%= current_user.name %> さん
                <% else %>
                    ユーザー名 さん
                <% end %>
            </p>
            <button class="button">View Profile</button>
            <button class="button">Edit Profile</button>
        </div>
    </div>

    <canvas id="goalsChart"></canvas>

    <script>
      document.addEventListener("DOMContentLoaded", function() {
        let ctx = document.getElementById('goalsChart').getContext('2d');
        let goalsChart = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: <%= @goals_data.present? ? @goals_data.keys.to_json.html_safe : [].to_json.html_safe %>,  // ログインしている場合のみデータを使用
            datasets: [{
              label: '目標達成数',
              data: <%= @goals_data.present? ? @goals_data.values.to_json.html_safe : [].to_json.html_safe %>, // ログインしている場合のみデータを使用
              backgroundColor: 'rgba(75, 192, 192, 0.2)',
              borderColor: 'rgba(75, 192, 192, 1)',
              borderWidth: 1
            }]
          },
          options: {
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
        });
      });
    </script>
    
    <% unless current_user %>
      <p>ログインしていません。目標の達成数を表示するにはログインしてください。</p>
    <% end %>    
    
</body>
</html>
